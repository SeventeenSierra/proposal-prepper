# Contributing to Proposal Prepper

Thank you for your interest in contributing to the Proposal Prepper (Contract Checker) project! This document explains our contribution process for this NSF PAPPG compliance validation system.

## Quick Start

1. Fork the repository
2. Create a feature branch from `develop`: `git checkout -b feat/my-feature develop`
3. Make changes with conventional commits
4. Sign off your commits: `git commit -s`
5. Push to your fork and create a Pull Request to the upstream `develop` branch.

## Contributor Verification: DCO and CLA

We use two levels of verification to protect the project and its contributors.

### 1. Developer Certificate of Origin (DCO) - **Mandatory**

All contributors **must** sign off their commits. This is the primary way we verify you have the right to submit the code. Corporate contributors (such as AWS) typically prefer this model.

To sign off, use the `-s` flag:
```bash
git commit -s -m "feat: add new feature"
```

This adds `Signed-off-by: Your Name <email>` to your commit. See [DCO.md](./DCO.md) (in the same directory) or the root license docs.

### 2. Contributor License Agreement (CLA)

In addition to the DCO, we require a CLA for significant contributions to ensure long-term sustainability.

- **Individual Contributors**: Must sign the CLA via [CLA Assistant](https://cla-assistant.io/) when submitting a PR.
- **Federal Government Employees**: 
    - ‚úÖ **No CLA required** (your work is public domain under 17 U.S.C. ¬ß 105)
    - ‚úÖ DCO sign-off is still required
    - ‚úÖ Add `US-Government-Work: true` to commit messages or PR description
- **Corporate Contributors (Large Organizations)**:
    - ‚úÖ **No CLA required** for organizations with strict legal policies (e.g., AWS, Amazon, Google)
    - ‚úÖ DCO sign-off is still required
    - ‚úÖ Add `Large-Org-Contribution: true` to commit messages or PR description
    - ‚úÖ Automatic bypass is enabled for many common corporate email domains

### Commit Message Examples

**Federal Contributor:**
```bash
git commit -s -m "feat: add compliance feature

US-Government-Work: true"
```

**Corporate Contributor:**
```bash
git commit -s -m "feat(web): add performance optimization

Large-Org-Contribution: true"
```

## AI-Human Pair Programming

This project embracing AI-human collaboration. We use agents like **Kiro**, **Antigravity**, and **Cline** to accelerate development while maintaining high standards through human oversight.

### The Design-First Workflow

We follow a strict **Design-First** approach. No code should be written without a clear plan:

1.  **Stage 1: Design & Specification**: Create a design document (`design.md`) and a task list (`task.md`) in a new session directory: `.agent/sessions/<N>-<name>/`.
2.  **Stage 2: Implementation**: Execute tasks in small, verifiable sections. Each section must end with a human review and a commit.
3.  **Stage 3: Verification**: Run the full suite of checks (lint, typecheck, test, build) before finalizing a session.

### Session Records

Every major change or work session is documented in `.agent/sessions/`. This provides an audit trail of decisions, architectural choices, and service impacts.

## Commit Standards

We use [Conventional Commits](https://www.conventionalcommits.org/) with specific requirements for our microservice architecture.

### Commit Format

```
<type>(<scope>): <description>
                                    ‚Üê BLANK LINE REQUIRED
[optional body]

Human-Involvement: <level>
AI-Agent: <model>                   ‚Üê If assisted by AI
Signed-off-by: <human>              ‚Üê Added via -s flag
```

### Types & Scopes

| Type | Description |
|------|-------------|
| `feat` | New feature |
| `fix` | Bug fix |
| `docs` | Documentation only |
| `style` | Formatting, no functional change (Biome) |
| `refactor` | Code restructuring |
| `test` | Adding or updating tests |
| `chore` | Maintenance, dependencies, etc. |
| `ci` | CI/CD configuration changes |

**Microservice Scopes:**
- **Services:** `web` (Next.js), `strands` (Python agent), `genkit` (Node.js/LLM)
- **Packages:** `ui` (@aatb/ui), `lib` (@aatb/lib)
- **Infrastructure:** `docker`, `railway`, `ci`, `deps`
- **Project Areas:** `compliance`, `orchestration`, `api`, `components`, `docs`, `config`, `security`, `tests`, `seed`, `schemas`

### Human Involvement Levels

- `full`: Human wrote the code, AI may have assisted.
- `reviewed`: AI wrote the code, human performed a line-by-line review.
- `approved`: AI wrote the code, human approved based on verification without full review.
- `automated`: Contribution was fully generated by an automated system.

### Examples

**Feature Addition (AI-Assisted):**
```bash
git commit -s -m "feat(strands): add NSF PAPPG Section 2.B validation

Implements Section 2.B.2(f)(i) validation for biographical sketches.

Human-Involvement: reviewed
AI-Agent: kiro"
```

**Bug Fix (Manual):**
```bash
git commit -s -m "fix(web): resolve proposal upload timeout

Human-Involvement: full"
```

## Development Workflow

### Prerequisites

- [Nix](https://nixos.org/) with flakes enabled
- Git with GPG signing configured

### Setup

```bash
# Enter dev environment
nix develop

# Install dependencies
pnpm install

# Run checks
pnpm run lint
pnpm run typecheck
pnpm run test
```

### Branch Strategy

We use **Gitflow** for development:

- `main` - Production-ready releases only
- `develop` - Integration branch for features
- `feature/*` - Feature development (branch from `develop`)
- `release/*` - Release preparation (branch from `develop`)
- `hotfix/*` - Critical fixes (branch from `main`)

**Workflow:**
1. Create feature branches from `develop`
2. Submit PRs to `develop` for integration
3. Release branches merge to both `main` and `develop`
4. Hotfixes merge to both `main` and `develop`

#### CI/CD Compliance
All PRs must pass the CI checks, which are powered by **GitHub Actions**:
- Linting (Biome)
- Typechecking (TypeScript)
- Tests (Vitest)
- Build Verification
- Secret Scanning (Gitleaks, Trivy, Semgrep)

The CI pipeline uses **Workload Identity Federation** to authenticate with Google Artifact Registry for private packages.

## Pull Requests Process

1. **Title**: Use conventional commit format
2. **Description**: Explain what and why
3. **Tests**: Add/update tests for changes
4. **Docs**: Update documentation if needed
5. **Sign-off**: Ensure all commits are signed

## Code Style

- TypeScript files: Biome formatting
- Python files: Ruff + Black
- All files need SPDX headers:

```typescript
// SPDX-License-Identifier: PolyForm-Strict-1.0.0
// SPDX-FileCopyrightText: 2025 Seventeen Sierra LLC
```

## Code of Conduct

This project and everyone participating in it is governed by our [Code of Conduct](CODE_OF_CONDUCT.md). By participating, you are expected to uphold this code. Please report unacceptable behavior to conduct@seventeensierra.com.

## Questions?

- üìß Email: dev@seventeensierra.com
- üí¨ Discussions: GitHub Discussions
- üö® Code of Conduct: conduct@seventeensierra.com
