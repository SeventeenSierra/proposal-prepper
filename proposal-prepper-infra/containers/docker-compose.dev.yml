# SPDX-License-Identifier: PolyForm-Strict-1.0.0
# SPDX-FileCopyrightText: 2025 Seventeen Sierra LLC

# Development-specific Docker Compose overrides
version: '3.8'

services:
  web:
    # Enable hot reload for development
    volumes:
      - ../../proposal-prepper-web:/app/proposal-prepper-web
      - ../../proposal-prepper-services/src:/app/proposal-prepper-web/src/services:ro
      - /app/proposal-prepper-web/node_modules
      - /app/proposal-prepper-web/.next
    environment:
      - WATCHPACK_POLLING=true
      - CHOKIDAR_USEPOLLING=true
      - FAST_REFRESH=true
    stdin_open: true
    tty: true
    # Override health check for faster development feedback
    healthcheck:
      interval: 15s
      timeout: 5s
      start_period: 30s
      retries: 2

  analysis-engine:
    # Enable hot reload for Python development
    volumes:
      - ../../proposal-prepper-backend:/app
      - ../../proposal-prepper-web/src/seed-data:/app/src/seed-data:ro
    environment:
      - PYTHONUNBUFFERED=1
      - WATCHFILES_FORCE_POLLING=true
      - LOG_LEVEL=DEBUG
    stdin_open: true
    tty: true
    # Override health check for faster development feedback
    healthcheck:
      interval: 15s
      timeout: 5s
      start_period: 45s
      retries: 2

  postgres:
    # Expose additional debugging options
    environment:
      - POSTGRES_LOG_STATEMENT=all
      - POSTGRES_LOG_MIN_DURATION_STATEMENT=0
    # Add development-specific volume for easier database inspection
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ../database/init.sql:/docker-entrypoint-initdb.d/init-db.sql:ro
      - ../database/seed-dev.sql:/docker-entrypoint-initdb.d/dev-data.sql:ro

  redis:
    # Development Redis configuration - lighter persistence settings
    volumes:
      - redis_data:/data
      - ./redis-dev.conf:/usr/local/etc/redis/redis.conf:ro
    command: redis-server /usr/local/etc/redis/redis.conf

  minio:
    # Add development console access
    environment:
      - MINIO_BROWSER_REDIRECT_URL=http://localhost:9001